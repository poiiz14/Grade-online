<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ระบบรายงานผลการเรียนนักศึกษา</title>

  <!-- Tailwind (CDN ใช้ทดสอบได้) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ไอคอน/ฟอนต์เสริม (ไม่บังคับ) -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-slate-100 min-h-screen text-slate-900">

  <!-- ================== LOGIN ================== -->
  <section id="loginScreen" class="max-w-xl mx-auto py-10 px-4">
    <div class="bg-white rounded-2xl shadow p-8">
      <h1 class="text-2xl font-bold mb-1">>ระบบรายงานผลการเรียนนักศึกษา</h1>
      <p class="text-sm text-slate-500 mb-6">เข้าสู่ระบบเพื่อใช้งาน</p>

      <form onsubmit="login(); return false;">
        <div class="mb-4">
          <label class="block text-sm mb-1">ประเภทผู้ใช้</label>
          <select id="userType" class="w-full border rounded-lg px-3 py-2">
            <option value="admin">ผู้ดูแลระบบ</option>
            <option value="advisor">อาจารย์ที่ปรึกษา</option>
            <option value="student">นักศึกษา</option>
          </select>
        </div>

        <!-- Admin -->
        <div class="grid grid-cols-1 gap-4">
          <div>
            <label class="block text-sm mb-1">อีเมล (ผู้ดูแล/ที่ปรึกษา)</label>
            <input id="adminEmail"    type="email" class="w-full border rounded-lg px-3 py-2" placeholder="admin@example.ac.th" />
            <input id="advisorEmail"  type="email" class="hidden" />
          </div>
          <div>
            <label class="block text-sm mb-1">รหัสผ่าน (ผู้ดูแล/ที่ปรึกษา)</label>
            <input id="adminPassword"   type="password" class="w-full border rounded-lg px-3 py-2" placeholder="••••••••" />
            <input id="advisorPassword" type="password" class="hidden" />
          </div>
        </div>

        <!-- Student -->
        <div class="mt-4">
          <label class="block text-sm mb-1">เลขบัตรประชาชน (นักศึกษา)</label>
          <input id="studentCitizenId" type="text" class="w-full border rounded-lg px-3 py-2" placeholder="13 หลัก" />
        </div>

        <button class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl py-3 font-medium">
          เข้าสู่ระบบ
        </button>
      </form>
    </div>
  </section>

  <!-- ================== DASHBOARD (WRAPPER) ================== -->
  <section id="dashboard" class="hidden max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold">แดชบอร์ด</h2>
      <div class="flex items-center gap-2">
        <button onclick="openChangePasswordModal()" class="px-3 py-2 rounded-lg border hover:bg-slate-50">เปลี่ยนรหัสผ่าน</button>
        <button onclick="logout()" class="px-3 py-2 rounded-lg bg-slate-800 text-white hover:bg-slate-900">ออกจากระบบ</button>
      </div>
    </div>

    <!-- ============ ADMIN DASHBOARD ============ -->
    <div id="adminDashboard" class="hidden">
      <!-- Nav -->
      <div class="flex gap-2 mb-4">
        <button class="admin-nav px-4 py-2 rounded-lg border border-transparent text-gray-600" onclick="showAdminSection('overview')">ภาพรวม</button>
        <button class="admin-nav px-4 py-2 rounded-lg border border-transparent text-gray-600" onclick="showAdminSection('students')">รายชื่อนักศึกษา</button>
        <button class="admin-nav px-4 py-2 rounded-lg border border-transparent text-gray-600" onclick="showAdminSection('individual')">ข้อมูลรายบุคคล</button>
      </div>

      <!-- ----- Overview ----- -->
      <div id="adminOverview" class="bg-white rounded-xl p-6 shadow mb-6">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-blue-50 p-4 rounded-lg">
            <p class="text-sm text-slate-600">จำนวนนักศึกษา</p>
            <p id="totalStudents" class="text-2xl font-bold text-blue-800">-</p>
          </div>
          <div class="bg-emerald-50 p-4 rounded-lg">
            <p class="text-sm text-slate-600">ผ่านอังกฤษ (ล่าสุด)</p>
            <p id="passedEnglish" class="text-2xl font-bold text-emerald-700">-</p>
          </div>
          <div class="bg-rose-50 p-4 rounded-lg">
            <p class="text-sm text-slate-600">ไม่ผ่านอังกฤษ (ล่าสุด)</p>
            <p id="failedEnglish" class="text-2xl font-bold text-rose-700">-</p>
          </div>
          <div class="bg-violet-50 p-4 rounded-lg">
            <p class="text-sm text-slate-600">รายวิชาที่เปิดสอน (ไม่ซ้ำ)</p>
            <p id="totalSubjects" class="text-2xl font-bold text-violet-700">-</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
          <div class="bg-slate-50 p-4 rounded-lg">
            <h4 class="font-semibold mb-2">จำนวนนักศึกษาแต่ละชั้นปี</h4>
            <canvas id="studentsChart" height="200"></canvas>
          </div>
          <div class="bg-slate-50 p-4 rounded-lg">
            <h4 class="font-semibold mb-2">สัดส่วนผลสอบอังกฤษ (ล่าสุด)</h4>
            <canvas id="englishChart" height="200"></canvas>
          </div>
        </div>
      </div>

      <!-- ----- Students list ----- -->
      <div id="adminStudents" class="hidden bg-white rounded-xl p-6 shadow mb-6">
        <div class="flex flex-col md:flex-row gap-3 mb-4">
          <div class="flex items-center gap-2">
            <span class="text-sm">ค้นหา:</span>
            <input id="adminStudentSearch" type="text" class="border rounded-lg px-3 py-2" placeholder="ชื่อ-สกุล" />
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm">ชั้นปี:</span>
            <select id="adminStudentYearFilter" class="border rounded-lg px-3 py-2">
              <option value="">ทั้งหมด</option>
              <option value="1">ปี 1</option>
              <option value="2">ปี 2</option>
              <option value="3">ปี 3</option>
              <option value="4">ปี 4</option>
            </select>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-slate-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs text-slate-500 uppercase">รหัส</th>
                <th class="px-6 py-3 text-left text-xs text-slate-500 uppercase">ชื่อ</th>
                <th class="px-6 py-3 text-left text-xs text-slate-500 uppercase">ชั้นปี</th>
                <th class="px-6 py-3 text-left text-xs text-slate-500 uppercase">ที่ปรึกษา</th>
                <th class="px-6 py-3"></th>
              </tr>
            </thead>
            <tbody id="studentsTable" class="divide-y divide-slate-200"></tbody>
          </table>
        </div>
      </div>

      <!-- ----- Individual ----- -->
      <div id="adminIndividual" class="hidden">
        <!-- Filter + KPI -->
        <div class="bg-white rounded-xl p-6 shadow mb-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="flex items-center gap-3">
              <label class="text-sm whitespace-nowrap">เลือกนักศึกษา:</label>
              <div class="flex-1 flex gap-2">
                <input id="adminIndSearch" type="text" class="border rounded-lg px-3 py-2 w-full" placeholder="ค้นหาชื่อ/รหัส" />
                <select id="adminIndSelect" class="border rounded-lg px-3 py-2 min-w-[220px]">
                  <option value="">— เลือกนักศึกษา —</option>
                </select>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <label class="text-sm whitespace-nowrap">ปีการศึกษา:</label>
              <select id="adminIndYear" class="border rounded-lg px-3 py-2 min-w-[160px]">
                <option value="">ทุกปีการศึกษา</option>
              </select>
            </div>

            <!-- KPI: GPAX -->
            <div class="bg-blue-50 p-4 rounded-lg">
              <p class="text-sm text-slate-600">GPAX (สะสม)</p>
              <p id="adminIndGPAX" class="text-2xl font-bold text-blue-800">-</p>
            </div>
            <div class="bg-emerald-50 p-4 rounded-lg">
              <p class="text-sm text-slate-600">หน่วยกิต (ปีที่เลือก)</p>
              <p id="adminIndYearCredits" class="text-2xl font-bold text-emerald-700">-</p>
            </div>
          </div>
        </div>

        <!-- Profile + buttons -->
        <div class="bg-white rounded-xl p-6 shadow mb-6">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div><p class="text-xs text-slate-500">รหัส</p><p id="detailStudentId" class="font-semibold">-</p></div>
            <div><p class="text-xs text-slate-500">ชื่อ</p><p id="detailStudentName" class="font-semibold">-</p></div>
            <div><p class="text-xs text-slate-500">ชั้นปี</p><p id="detailStudentYear" class="font-semibold">-</p></div>
            <div><p class="text-xs text-slate-500">ที่ปรึกษา</p><p id="detailStudentAdvisor" class="font-semibold">-</p></div>
          </div>
          <div class="mt-4 flex flex-wrap gap-2">
            <button id="btnEditStudent" class="px-4 py-2 rounded-lg bg-slate-800 text-white hover:bg-slate-900">แก้ไขข้อมูล</button>
            <button id="btnAddGrade"   class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700">เพิ่มเกรด</button>
            <button id="btnAddEnglish" class="px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700">เพิ่มผลสอบอังกฤษ</button>
          </div>
        </div>

        <!-- Grades table -->
        <div class="bg-white rounded-xl p-6 shadow mb-6">
          <h3 class="text-lg font-semibold mb-3">ผลการเรียน</h3>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-slate-50">
                <tr>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ภาคการศึกษา</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">รหัสวิชา</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ชื่อวิชา</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">หน่วยกิต</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">เกรด</th>
                </tr>
              </thead>
              <tbody id="gradesDetailTable" class="divide-y divide-slate-200"></tbody>
            </table>
          </div>
          <div class="mt-3 text-right text-sm">
            <span class="font-medium">GPA (ปีที่เลือก): </span><span id="adminIndYearGPA">-</span>
          </div>
        </div>

        <!-- English all attempts -->
        <div class="bg-white rounded-xl p-6 shadow mb-6">
          <h3 class="text-lg font-semibold mb-3">ผลสอบภาษาอังกฤษ (ทั้งหมด)</h3>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-slate-50">
                <tr>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ปีการศึกษา</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ครั้งที่สอบ</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">คะแนน</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">สถานะ</th>
                  <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">วันที่สอบ</th>
                </tr>
              </thead>
              <tbody id="englishTestTable" class="divide-y divide-slate-200"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ============ STUDENT DASHBOARD ============ -->
    <div id="studentDashboard" class="hidden">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-blue-50 p-4 rounded-lg">
          <p class="text-sm text-slate-600">GPAX (สะสม)</p>
          <p id="studentGPAX" class="text-2xl font-bold text-blue-800">-</p>
        </div>
        <div class="bg-emerald-50 p-4 rounded-lg">
          <p class="text-sm text-slate-600">หน่วยกิตสะสม (ไม่ซ้ำรายวิชา)</p>
          <p id="studentCredits" class="text-2xl font-bold text-emerald-700">-</p>
        </div>
        <div class="bg-violet-50 p-4 rounded-lg">
          <p class="text-sm text-slate-600">สถานะสอบอังกฤษ (ครั้งล่าสุด)</p>
          <p id="studentEnglishStatus" class="text-2xl font-bold text-violet-700">-</p>
        </div>
      </div>

      <div class="bg-white rounded-xl p-6 shadow mb-6">
        <div class="flex flex-wrap items-center gap-3 mb-3">
          <label class="text-sm">ปีการศึกษา:</label>
          <select id="studentAcademicYear" class="border rounded-lg px-3 py-2 min-w-[160px]">
            <option value="">ทุกปีการศึกษา</option>
          </select>

          <div class="ml-auto flex gap-2">
            <button class="semester-tab px-3 py-2 border rounded-lg text-gray-700" onclick="showSemester('1')">ภาค 1</button>
            <button class="semester-tab px-3 py-2 border rounded-lg text-gray-700" onclick="showSemester('2')">ภาค 2</button>
            <button class="semester-tab px-3 py-2 border rounded-lg text-gray-700" onclick="showSemester('3')">ฤดูร้อน</button>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-slate-50">
              <tr>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ภาคการศึกษา</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">รหัสวิชา</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ชื่อวิชา</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">หน่วยกิต</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">เกรด</th>
              </tr>
            </thead>
            <tbody id="studentSemesterTable" class="divide-y divide-slate-200"></tbody>
          </table>
        </div>
      </div>

      <div class="bg-white rounded-xl p-6 shadow mb-6">
        <h3 class="text-lg font-semibold mb-3">ผลสอบภาษาอังกฤษ (ทุกปีการศึกษา)</h3>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-slate-50">
              <tr>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ปีการศึกษา</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ครั้งที่สอบ</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">คะแนน</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">สถานะ</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">วันที่สอบ</th>
              </tr>
            </thead>
            <tbody id="studentEnglishTable" class="divide-y divide-slate-200"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ============ ADVISOR DASHBOARD ============ -->
    <div id="advisorDashboard" class="hidden">
      <div class="bg-white rounded-xl p-6 shadow mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-blue-50 p-4 rounded-lg">
            <p class="text-sm text-slate-600">จำนวนนักศึกษาทั้งหมด</p>
            <p id="advTotal" class="text-2xl font-bold text-blue-800">-</p>
            <p class="text-xs text-slate-600 mt-2">
              ปี 1: <span id="advY1">-</span> •
              ปี 2: <span id="advY2">-</span> •
              ปี 3: <span id="advY3">-</span> •
              ปี 4: <span id="advY4">-</span>
            </p>
          </div>
          <div class="bg-emerald-50 p-4 rounded-lg">
            <p class="text-sm text-slate-600">ผ่านอังกฤษ (ผลล่าสุด)</p>
            <p id="advPassLatest" class="text-2xl font-bold text-emerald-700">-</p>
          </div>
          <div class="p-4 rounded-lg">
            <label class="block text-sm mb-1">กรองปีการศึกษา (สำหรับรายละเอียด):</label>
            <select id="advisorAcademicYear" class="border rounded-lg px-3 py-2 min-w-[160px]">
              <option value="">ทั้งหมด</option>
            </select>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl p-6 shadow mb-6">
        <h3 class="font-semibold mb-3">นักศึกษาในความดูแล</h3>
        <div id="advisorStudentsList" class="divide-y divide-slate-200"></div>
      </div>

      <div class="bg-white rounded-xl p-6 shadow mb-6">
        <h3 class="font-semibold mb-3">สรุปผลสอบภาษาอังกฤษ (ล่าสุดต่อคน)</h3>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-slate-50">
              <tr>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">รหัส</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">ชื่อ</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">สถานะ</th>
                <th class="px-4 py-2 text-left text-xs text-slate-500 uppercase">วันที่สอบ</th>
              </tr>
            </thead>
            <tbody id="advisorEnglishTable" class="divide-y divide-slate-200"></tbody>
          </table>
        </div>
      </div>
    </div>

  </section>

  <!-- ================== MODALS ================== -->
  <div id="modalBackdrop" class="hidden fixed inset-0 bg-black/40 z-40"></div>

  <!-- Edit Student -->
  <div id="modalEditStudent" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="bg-white w-full max-w-lg rounded-xl shadow p-6">
      <h3 class="font-semibold mb-4">แก้ไขข้อมูลนักศึกษา</h3>
      <div class="grid grid-cols-1 gap-3">
        <input id="editStudentId" class="border rounded-lg px-3 py-2" placeholder="รหัสนักศึกษา" />
        <input id="editStudentName" class="border rounded-lg px-3 py-2" placeholder="ชื่อ-สกุล" />
        <input id="editStudentAdvisor" class="border rounded-lg px-3 py-2" placeholder="อีเมลอาจารย์ที่ปรึกษา" />
        <select id="editStudentYear" class="border rounded-lg px-3 py-2">
          <option value="1">ปี 1</option><option value="2">ปี 2</option>
          <option value="3">ปี 3</option><option value="4">ปี 4</option>
        </select>
      </div>
      <div class="mt-5 flex justify-end gap-2">
        <button onclick="closeModal('modalEditStudent')" class="px-4 py-2 rounded-lg border">ยกเลิก</button>
        <button onclick="saveEditStudent()" class="px-4 py-2 rounded-lg bg-blue-600 text-white">บันทึก</button>
      </div>
    </div>
  </div>

  <!-- Add Grade -->
  <div id="modalAddGrade" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="bg-white w-full max-w-lg rounded-xl shadow p-6">
      <h3 class="font-semibold mb-4">เพิ่มผลการเรียน</h3>
      <div class="grid grid-cols-1 gap-3">
        <input id="gradeStudentId" class="border rounded-lg px-3 py-2" placeholder="รหัสนักศึกษา" />
        <input id="gradeTerm" class="border rounded-lg px-3 py-2" placeholder="ปี/ภาค (เช่น 2568/1 หรือ 2568/ฤดูร้อน)" />
        <input id="gradeCourseCode" class="border rounded-lg px-3 py-2" placeholder="รหัสวิชา" />
        <input id="gradeCourseTitle" class="border rounded-lg px-3 py-2" placeholder="ชื่อวิชา" />
        <input id="gradeCredits" class="border rounded-lg px-3 py-2" placeholder="หน่วยกิต" type="number" step="0.5" />
        <input id="gradeGrade" class="border rounded-lg px-3 py-2" placeholder="เกรด (A,B+,...)" />
        <input id="gradeRecordedAt" class="border rounded-lg px-3 py-2" placeholder="วันที่บันทึก (YYYY-MM-DD)" />
      </div>
      <div class="mt-5 flex justify-end gap-2">
        <button onclick="closeModal('modalAddGrade')" class="px-4 py-2 rounded-lg border">ยกเลิก</button>
        <button onclick="saveAddGrade()" class="px-4 py-2 rounded-lg bg-blue-600 text-white">บันทึก</button>
      </div>
    </div>
  </div>

  <!-- Add English -->
  <div id="modalAddEnglish" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="bg-white w-full max-w-lg rounded-xl shadow p-6">
      <h3 class="font-semibold mb-4">เพิ่มผลสอบภาษาอังกฤษ</h3>
      <div class="grid grid-cols-1 gap-3">
        <input id="engStudentId" class="border rounded-lg px-3 py-2" placeholder="รหัสนักศึกษา" />
        <input id="engAcademicYear" class="border rounded-lg px-3 py-2" placeholder="ปีการศึกษา (เช่น 2568)" />
        <input id="engAttempt" class="border rounded-lg px-3 py-2" placeholder="ครั้งที่สอบ" />
        <input id="engScore" class="border rounded-lg px-3 py-2" placeholder="คะแนน" />
        <input id="engStatus" class="border rounded-lg px-3 py-2" placeholder="สถานะ (ผ่าน/ไม่ผ่าน)" />
        <input id="engExamDate" class="border rounded-lg px-3 py-2" placeholder="วันที่สอบ (YYYY-MM-DD)" />
      </div>
      <div class="mt-5 flex justify-end gap-2">
        <button onclick="closeModal('modalAddEnglish')" class="px-4 py-2 rounded-lg border">ยกเลิก</button>
        <button onclick="saveAddEnglish()" class="px-4 py-2 rounded-lg bg-blue-600 text-white">บันทึก</button>
      </div>
    </div>
  </div>

  <!-- Advisor Detail -->
  <div id="modalAdvisorDetail" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="bg-white w-full max-w-4xl rounded-xl shadow p-6">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-semibold">รายละเอียดนักศึกษา</h3>
        <button onclick="closeModal('modalAdvisorDetail')" class="px-3 py-1.5 rounded-lg border">ปิด</button>
      </div>
      <div id="advisorDetailContent"></div>
    </div>
  </div>

  <!-- ================== SCRIPTS ================== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="app.js"></script>
</body>
</html>

